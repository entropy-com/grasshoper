Object.defineProperty(exports,"__esModule",{value:!0});var e=require("ts-deepmerge");function t(e,t){let r=new globalThis.AbortController;function s(e){r.abort(e),o()}let n=[];for(let t of e){if((null==t?void 0:t.aborted)===!0){s(t.reason);break}if((null==t?void 0:t.addEventListener)!=null){let e=()=>{s(t.reason)};n.push(()=>{(null==t?void 0:t.removeEventListener)!=null&&t.removeEventListener("abort",e)}),t.addEventListener("abort",e)}}function o(){n.forEach(e=>{e()}),null==t||t()}let a=r.signal;return a.clear=o,a}function r(e,t=!0,s=null){if(null==e)return"";let n=[],o=t?encodeURIComponent:e=>e;for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a)){let i=e[a],u=s?`${s}[${o(a)}]`:o(a);if("object"==typeof i){let e=r(i,t,u);""!==e&&n.push(e)}else Array.isArray(i)?i.forEach((e,t)=>{let r=`${u}[${t}]`;n.push(`${o(r)}=${o(e)}`)}):n.push(`${o(u)}=${o(i)}`)}return n.join("&")}function s(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}class n extends Error{constructor(e,t,r){super(e),this.request=t,this.config=t,this.response=r}}class o extends n{}function a(e,t,r,s,n,o,a){try{var i=e[o](a),u=i.value}catch(e){r(e);return}i.done?t(u):Promise.resolve(u).then(s,n)}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}const u="application/x-www-form-urlencoded",l="application/json";function c(e){return p.apply(this,arguments)}function p(){var t;return t=function*(t){let s=t.encode||t.paramsSerializer||r,n=!1!==t.encodeURI,o=t.method?t.method.toUpperCase():"GET",a=t.url||"",c=a,p=t.data,d=!1,h=(null==t?void 0:t.headers)||{};if(p&&!(p instanceof FormData)){let r="";if(null==t?void 0:t.headers){let e=Object.keys(t.headers).find(e=>"content-type"===e.toLowerCase());e&&(r=t.headers[e])}if(r||(r="GET"===o||"HEAD"===o?u:l,h["Content-Type"]=r),r===u&&("object"==typeof p||t.params)){d=!0;let r=s(e.merge(p||{},t.params||{}),n);r&&(a=a.includes("?")?a+=`&${r}`:`${a}?${r}`),p=null}else r===l&&(p=JSON.stringify(p))}return!d&&t.params&&Object.keys(t.params).length>0&&(a=a.includes("?")?a+=`&${s(t.params,n)}`:`${a}?${s(t.params,n)}`),i({},t,{data:p,url:c,_url:a,method:o,headers:h,encode:s,paramsSerializer:s})},(p=function(){var e=this,r=arguments;return new Promise(function(s,n){var o=t.apply(e,r);function i(e){a(o,s,n,i,u,"next",e)}function u(e){a(o,s,n,i,u,"throw",e)}i(void 0)})}).apply(this,arguments)}function d(e,t,r,s,n,o,a){try{var i=e[o](a),u=i.value}catch(e){r(e);return}i.done?t(u):Promise.resolve(u).then(s,n)}function h(e){return function(){var t=this,r=arguments;return new Promise(function(s,n){var o=e.apply(t,r);function a(e){d(o,s,n,a,i,"next",e)}function i(e){d(o,s,n,a,i,"throw",e)}a(void 0)})}}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}const y="undefined"!=typeof AbortController;class m{static create(e){return new m(e)}get interceptors(){return{request:{use:(e,t)=>(this.requestInterceptors.push(e),e),eject:e=>{this.requestInterceptors=this.requestInterceptors.filter(t=>t!==e)},clear:()=>{this.requestInterceptors=[this.requestInterceptors[0]]}},response:{use:(e,t)=>(this.responseInterceptors.push({fn:e,onRejected:t}),e),eject:e=>{this.responseInterceptors=this.responseInterceptors.filter(t=>t.fn!==e)},clear:()=>{this.responseInterceptors=[]}}}}get plugins(){return{use:e=>(this._plugins.push(e),e),eject:e=>{this._plugins=this._plugins.filter(t=>t!==e)},clear:()=>{this._plugins=[]}}}request(t){var r=this;return h(function*(){let s=e.merge({},r.config||{},r.defaults||{},"string"==typeof t?{url:t}:t||{},{headers:{},params:{}});for(let e of r.requestInterceptors)s=yield e(s);let n=r.handlerFetch.bind(r);return r._plugins.forEach(e=>{n=e(n)}),n(s)})()}handlerFetch(e){var r=this;return h(function*(){var a;let i,u;let{url:l,method:c,headers:p,timeout:d,signal:h,data:m}=e,v=function(e,t){if(null==e)return{};var r,s,n={},o=Object.keys(e);for(s=0;s<o.length;s++)t.indexOf(r=o[s])>=0||(n[r]=e[r]);return n}(e,["url","method","headers","timeout","signal","data"]),g=[];if(d&&y){let t=new AbortController;u=setTimeout(()=>{t.abort(new o(`timeout of ${d}ms exceeded`,e))},d),g.push(t.signal)}h&&g.push(h),i=g[0],g.length>1&&(i=t(g,()=>{clearTimeout(u)}));let b=e._url||l||"";e.baseURL&&!s(b)&&(b=(e.baseURL.endsWith("/")?e.baseURL:e.baseURL+"/")+(b.startsWith("/")?b.slice(1):b));let x=yield fetch(b,f({body:["HEAD","GET"].includes(e.method||"GET")?void 0:m},v,{signal:i,method:c,headers:p}));if(u&&clearTimeout(u),null==i||null==(a=i.clear)||a.call(i),!x.ok){let t;try{(t=yield x.text())&&(t=JSON.parse(t))}catch(e){}let s=new n(x.status?`Request failed with status code ${x.status}`:"Network error",e,{response:x,data:t,config:e,status:x.status,statusText:x.statusText,headers:x.headers});for(let e of r.responseInterceptors)e.onRejected&&(yield e.onRejected(s));throw s}if("HEAD"===e.method)return{data:void 0,request:e,config:e,response:x,headers:x.headers,status:x.status,statusText:x.statusText};if(!e.responseType||"json"===e.responseType||"text"===e.responseType){let t;try{t={data:yield x.text()};try{t.data&&"text"!==e.responseType&&(t.data=JSON.parse(t.data))}catch(e){}}catch(e){t={data:void 0}}let s={data:t.data,request:e,response:x};for(let e of r.responseInterceptors)s=yield e.fn(s);return{data:s.data,request:e,config:e,response:x,headers:x.headers,status:x.status,statusText:x.statusText}}return{data:void 0,request:e,config:e,response:x,headers:x.headers,status:x.status,statusText:x.statusText}})()}createGetHandler(e){return(t,r)=>this.request(r?f({},r,{method:e,url:t}):{method:e,url:t})}createPostHandler(e){return(t,r,s)=>this.request(s?f({},s,{method:e,url:t,data:r}):{method:e,url:t,data:r})}get(e,t){return this.createGetHandler("GET")(e,t)}head(e,t){return this.createGetHandler("HEAD")(e,t)}post(e,t,r){return this.createPostHandler("POST")(e,t,r)}put(e,t,r){return this.createPostHandler("PUT")(e,t,r)}patch(e,t,r){return this.createPostHandler("PATCH")(e,t,r)}delete(e,t){return this.createGetHandler("DELETE")(e,t)}options(e,t,r){return this.createPostHandler("OPTIONS")(e,t,r)}constructor(e){this.requestInterceptors=[c],this.responseInterceptors=[],this._plugins=[],this.config=e,this.defaults={params:{},headers:{}}}}Object.defineProperty(exports,"merge",{enumerable:!0,get:function(){return e.merge}}),exports.XiorError=n,exports.XiorTimeoutError=o,exports.anySignal=t,exports.buildSortedURL=function(e,t,r){let s=t?r(t):"";s&&(s=e.includes("?")?e+"&"+s:e+"?"+s);let[n,o]=s.split("?");if(o){let e=o.split("&");return`${n}?${e.sort().join("&")}`}return s||e},exports.default=m,exports.delay=function(e){return new Promise(t=>{setTimeout(()=>{t("ok")},e)})},exports.encodeParams=r,exports.isAbsoluteURL=s,exports.xior=m;
