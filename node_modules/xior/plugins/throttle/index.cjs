Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tiny-lru");function t(e,t,n,r,i,u,o){try{var l=e[u](o),a=l.value}catch(e){n(e);return}l.done?t(a):Promise.resolve(a).then(r,i)}function n(e){return function(){var n=this,r=arguments;return new Promise(function(i,u){var o=e.apply(n,r);function l(e){t(o,i,u,l,a,"next",e)}function a(e){t(o,i,u,l,a,"throw",e)}l(void 0)})}}exports.default=function(t={}){let{enableThrottle:r,threshold:i=1e3,throttleCache:u=e.lru(10)}=t;return function(e){let t=(t,r)=>{let i=n(function*(){try{let n=yield e(r);return u.set(t,{timestamp:Date.now(),value:Promise.resolve(n)}),n}catch(e){throw"delete"in u?u.delete(t):u.del(t),e}})();return u.set(t,{timestamp:Date.now(),value:i}),i};return n(function*(n){let{_url:o,encode:l,threshold:a=i,enableThrottle:s=r,data:f}=n,c="GET"===n.method||n.isGet,d=typeof s;if("undefined"===d?c:"function"===d?s(n):!!s){let e=function(e,t,n){let r=t?n(t):"";r&&(r=e.includes("?")?e+"&"+r:e+"?"+r);let[i,u]=r.split("?");if(u){let e=u.split("&");return`${i}?${e.sort().join("&")}`}return r||e}(o,f,l),r=Date.now(),i=u.get(e)||{timestamp:r};if(r-i.timestamp<=a){let e=i.value;if(e)return e}return t(e,n)}return e(n)})}};
